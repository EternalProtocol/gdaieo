import{ak as l,aA as D,ag as p,ac as E,af as T,aK as x,gr as A,ae as H,Y as O,bx as C,gs as N,aP as m,cg as j,aO as I,bl as B}from"./index--azQDwp6.js";class R extends l{constructor({domain:t}){super(`Invalid domain "${D(t)}".`,{metaMessages:["Must be a valid EIP-712 domain."]})}}class W extends l{constructor({primaryType:t,types:s}){super(`Invalid primary type \`${t}\` must be one of \`${JSON.stringify(Object.keys(s))}\`.`,{docsPath:"/api/glossary/Errors#typeddatainvalidprimarytypeerror",metaMessages:["Check that the primary type is a key in `types`."]})}}class F extends l{constructor({type:t}){super(`Struct type "${t}" is invalid.`,{metaMessages:["Struct type must not be a Solidity type."],name:"InvalidStructTypeError"})}}function G(e){const{domain:t={},message:s,primaryType:r}=e,n={EIP712Domain:$({domain:t}),...e.types};J({domain:t,message:s,primaryType:r,types:n});const a=["0x1901"];return t&&a.push(P({domain:t,types:n})),r!=="EIP712Domain"&&a.push(v({data:s,primaryType:r,types:n})),p(E(a))}function P({domain:e,types:t}){return v({data:e,primaryType:"EIP712Domain",types:t})}function v({data:e,primaryType:t,types:s}){const r=w({data:e,primaryType:t,types:s});return p(r)}function w({data:e,primaryType:t,types:s}){const r=[{type:"bytes32"}],n=[V({primaryType:t,types:s})];for(const a of s[t]){const[i,f]=M({types:s,name:a.name,type:a.type,value:e[a.name]});r.push(i),n.push(f)}return T(r,n)}function V({primaryType:e,types:t}){const s=x(_({primaryType:e,types:t}));return p(s)}function _({primaryType:e,types:t}){let s="";const r=S({primaryType:e,types:t});r.delete(e);const n=[e,...Array.from(r).sort()];for(const a of n)s+=`${a}(${t[a].map(({name:i,type:f})=>`${f} ${i}`).join(",")})`;return s}function S({primaryType:e,types:t},s=new Set){const r=e.match(/^\w*/u),n=r==null?void 0:r[0];if(s.has(n)||t[n]===void 0)return s;s.add(n);for(const a of t[n])S({primaryType:a.type,types:t},s);return s}function M({types:e,name:t,type:s,value:r}){if(e[s]!==void 0)return[{type:"bytes32"},p(w({data:r,primaryType:s,types:e}))];if(s==="bytes")return r=`0x${(r.length%2?"0":"")+r.slice(2)}`,[{type:"bytes32"},p(r)];if(s==="string")return[{type:"bytes32"},p(x(r))];if(s.lastIndexOf("]")===s.length-1){const n=s.slice(0,s.lastIndexOf("[")),a=r.map(i=>M({name:t,type:n,types:e,value:i}));return[{type:"bytes32"},p(T(a.map(([i])=>i),a.map(([,i])=>i)))]}return[{type:s},r]}function Q(e){const{domain:t,message:s,primaryType:r,types:n}=e,a=(g,h)=>{const c={...h};for(const o of g){const{name:y,type:d}=o;d==="address"&&(c[y]=c[y].toLowerCase())}return c},i=n.EIP712Domain?t?a(n.EIP712Domain,t):{}:{},f=(()=>{if(r!=="EIP712Domain")return a(n[r],s)})();return D({domain:i,message:f,primaryType:r,types:n})}function J(e){const{domain:t,message:s,primaryType:r,types:n}=e,a=(i,f)=>{for(const g of i){const{name:h,type:c}=g,o=f[h],y=c.match(A);if(y&&(typeof o=="number"||typeof o=="bigint")){const[z,u,k]=y;H(o,{signed:u==="int",size:Number.parseInt(k)/8})}if(c==="address"&&typeof o=="string"&&!O(o))throw new C({address:o});const d=c.match(N);if(d){const[z,u]=d;if(u&&m(o)!==Number.parseInt(u))throw new j({expectedSize:Number.parseInt(u),givenSize:m(o)})}const b=n[c];b&&(K(c),a(b,o))}};if(n.EIP712Domain&&t){if(typeof t!="object")throw new R({domain:t});a(n.EIP712Domain,t)}if(r!=="EIP712Domain")if(n[r])a(n[r],s);else throw new W({primaryType:r,types:n})}function $({domain:e}){return[typeof(e==null?void 0:e.name)=="string"&&{name:"name",type:"string"},(e==null?void 0:e.version)&&{name:"version",type:"string"},(typeof(e==null?void 0:e.chainId)=="number"||typeof(e==null?void 0:e.chainId)=="bigint")&&{name:"chainId",type:"uint256"},(e==null?void 0:e.verifyingContract)&&{name:"verifyingContract",type:"address"},(e==null?void 0:e.salt)&&{name:"salt",type:"bytes32"}].filter(Boolean)}function U({domain:e}){return P({domain:e,types:{EIP712Domain:$({domain:e})}})}function K(e){if(e==="address"||e==="bool"||e==="string"||e.startsWith("bytes")||e.startsWith("uint")||e.startsWith("int"))throw new F({type:e})}const L=`Ethereum Signed Message:
`;function Y(e){const t=typeof e=="string"?I(e):typeof e.raw=="string"?e.raw:B(e.raw),s=I(`${L}${m(t)}`);return E([s,t])}function X(e,t){return p(Y(e),t)}export{R as I,X as a,W as b,F as c,U as d,P as e,v as f,$ as g,G as h,L as p,Q as s,Y as t,J as v};
